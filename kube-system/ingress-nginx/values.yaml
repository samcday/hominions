# https://github.com/kubernetes/ingress-nginx/blob/main/charts/ingress-nginx/values.yaml

controller:
  extraContainers:
    - image: tailscale/tailscale:v1.33
      name: tailscale
      command:
        - /bin/sh
        - -c
        - |-
          tailscaled --state=kube:ingress-ts-auth-key --tun=userspace-networking --port=31642 &
          PID=$!
          tailscale up --login-server=https://samcday-headscale.fly.dev/ --authkey=$TS_AUTH_KEY --accept-dns=false
          wait $PID
      envFrom:
        - secretRef:
            name: services-tailscale-auth
      lifecycle:
        preStop:
          exec:
            command:
              - tailscale
              - down
      livenessProbe:
        exec:
          command:
            - tailscale
            - ping
            - hominion.hominion.tailnet.samcday.com
        initialDelaySeconds: 3
        periodSeconds: 5
      resources:
        requests:
          cpu: 100m
          memory: 64Mi
        limits:
          cpu: '2'
          memory: 1Gi
  kind: Deployment
  metrics:
    enabled: true
  service:
    externalIPs: [100.64.0.9]
  terminationGracePeriodSeconds: 5
  updateStrategy:
    type: Recreate
